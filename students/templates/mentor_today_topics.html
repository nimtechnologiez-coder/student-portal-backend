{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mentor Dashboard ‚Äì Today's Topics</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background: #f2fdfc; font-family: "Poppins", sans-serif; }

.table-container {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin-top: 30px;
}

.table th { background: #009688; color: white; }

.btn-add {
    background:#009688;
    color:white!important;
    padding:8px 18px;
    border-radius:8px;
    font-weight:600;
    text-decoration:none!important;
}

.filter-box {
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    margin-top: 20px;
}

.btn-edit, .btn-delete {
    padding:4px 10px;
    font-size:13px;
    border-radius:6px;
    font-weight:600;
    border:none;
}

.btn-edit { background:#0277bd; color:white; }
.btn-edit:hover { background:#015a8a; }

.btn-delete { background:#d32f2f; color:white; }
.btn-delete:hover { background:#b71c1c; }

.modal-header { background:#009688; color:white; }
.form-control { border-radius: 8px; border:1px solid #b2dfdb; }

.btn-save {
    background:#009688;
    color:white;
    padding:8px 18px;
    border-radius:8px;
    font-weight:600;
}

.btn-save:hover { opacity: 0.9; }
/* Action button wrapper */
.action-buttons {
    display: flex;
    justify-content: center;
    gap: 6px;
}

/* Common button styles */
.btn-edit,
.btn-delete {
    padding: 4px 10px;          /* ‚úÖ Correct size */
    font-size: 12.5px;          /* ‚úÖ Dashboard standard */
    font-weight: 600;
    line-height: 1.2;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    transition: all 0.15s ease-in-out;
}

/* Edit button */
.btn-edit {
    background-color: #0277bd;
    color: #ffffff;
}

.btn-edit:hover {
    background-color: #01579b;
}

/* Delete button */
.btn-delete {
    background-color: #d32f2f;
    color: #ffffff !important;
    text-decoration: none;
}

.btn-delete:hover {
    background-color: #b71c1c;
}

</style>
</head>

<body>

{% include 'navbar.html' %}

<div class="container">

    <div class="d-flex justify-content-between align-items-center mt-4">
        <h2 class="fw-bold">üë®‚Äçüè´ Mentor Dashboard</h2>
        <a href="{% url 'add_topic' %}" class="btn-add">‚ûï Add Topic</a>
    </div>

    <p class="text-center text-secondary">
        Showing topics for <b>{{ today }}</b>
    </p>

    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-success text-center">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <!-- FILTER -->
    <div class="filter-box">
        <form method="get" class="row gy-2 gx-3">

            <div class="col-md-3">
                <label>From Date</label>
                <input type="date" name="from_date" class="form-control" value="{{ from_date }}">
            </div>

            <div class="col-md-3">
                <label>To Date</label>
                <input type="date" name="to_date" class="form-control" value="{{ to_date }}">
            </div>

            <div class="col-md-3">
                <label>Course</label>
                <select name="course" class="form-control">
                    <option value="">-- All Courses --</option>
                    {% for c in courses %}
                      <option value="{{ c.course_name }}"
                        {% if selected_course == c.course_name %}selected{% endif %}>
                        {{ c.course_name }}
                      </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-3 mt-4">
                <button class="btn btn-success w-100">Filter</button>
            </div>

        </form>
    </div>

    <!-- TABLE -->
    <div class="table-container">
        <table class="table table-bordered table-hover text-center">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Course</th>
                    <th>Batch</th>
                    <th>Date</th>
                    <th>Start</th>
                    <th>End</th>
                    <th>Topic</th>
                    <th>Description</th>
                    <th>Trainer</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                {% for t in topics %}
                <tr class="{% if t.date == today %}table-success{% endif %}">
                    <td>{{ t.student.user.first_name }}</td>
                    <td>{{ t.student.course.course_name }}</td>
                    <td>{{ t.batch.batch_name }}</td>
                    <td>{{ t.date }}</td>
                    <td>{{ t.start_time }}</td>
                    <td>{{ t.end_time }}</td>
                    <td>{{ t.title }}</td>
                    <td>{{ t.description }}</td>
                    <td>{{ t.trainer }}</td>

                    <td>
                        <div class="d-flex justify-content-center gap-2">

                            <!-- EDIT -->
                            <button
                              class="btn-edit"
                              data-bs-toggle="modal"
                              data-bs-target="#editModal"
                              data-id="{{ t.id }}"
                              data-date="{{ t.date|date:'Y-m-d' }}"
                              data-start="{{ t.start_time|time:'H:i' }}"
                              data-end="{{ t.end_time|time:'H:i' }}"
                              data-title="{{ t.title }}"
                              data-description="{{ t.description }}"
                              data-student="{{ t.student.user.first_name }}"
                              data-course="{{ t.student.course.course_name }}"
                              data-batch="{{ t.batch.batch_name }}">
                              ‚úèÔ∏è Edit
                            </button>

                            <!-- DELETE (SECURE POST) -->
                            <form method="POST" action="{% url 'mentor_delete_topic' t.id %}">
                                {% csrf_token %}
                                <button class="btn-delete"
                                  onclick="return confirm('Delete topic?');">
                                  üóë Delete
                                </button>
                            </form>

                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="10" class="text-danger fw-bold">
                    No Topics Found
                  </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- EDIT MODAL -->
<div class="modal fade" id="editModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5>Edit Topic</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form method="POST" action="{% url 'update_topic' %}">
        {% csrf_token %}
        <input type="hidden" id="edit-id" name="topic_id">

        <div class="modal-body row">

          <div class="col-md-4 mb-3">
            <label>Date</label>
            <input type="date" id="edit-date" name="date" class="form-control" required>
          </div>

          <div class="col-md-4 mb-3">
            <label>Start</label>
            <input type="time" id="edit-start" name="start_time" class="form-control" required>
          </div>

          <div class="col-md-4 mb-3">
            <label>End</label>
            <input type="time" id="edit-end" name="end_time" class="form-control" required>
          </div>

          <div class="col-md-12 mb-3">
            <label>Topic</label>
            <input type="text" id="edit-title" name="title" class="form-control" required>
          </div>

          <div class="col-md-12 mb-3">
            <label>Description</label>
            <textarea id="edit-description" name="description" class="form-control" rows="3" required></textarea>
          </div>

          <div class="col-md-6 mb-3">
            <label>Student</label>
            <input type="text" id="edit-student" class="form-control" readonly>
          </div>

          <div class="col-md-6 mb-3">
            <label>Course</label>
            <input type="text" id="edit-course" class="form-control" readonly>
          </div>

          <div class="col-md-12 mb-3">
            <label>Batch</label>
            <input type="text" id="edit-batch" class="form-control" readonly>
          </div>

        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn-save" type="submit">Save</button>
        </div>
      </form>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.getElementById('editModal').addEventListener('show.bs.modal', function(e) {
    const b = e.relatedTarget;
    document.getElementById("edit-id").value = b.dataset.id;
    document.getElementById("edit-date").value = b.dataset.date;
    document.getElementById("edit-start").value = b.dataset.start;
    document.getElementById("edit-end").value = b.dataset.end;
    document.getElementById("edit-title").value = b.dataset.title;
    document.getElementById("edit-description").value = b.dataset.description;
    document.getElementById("edit-student").value = b.dataset.student;
    document.getElementById("edit-course").value = b.dataset.course;
    document.getElementById("edit-batch").value = b.dataset.batch;
});
</script>

</body>
</html>
